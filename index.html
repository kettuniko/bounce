<html>
  <head>
    <style>
      html, body { margin: 0; background-color: rgba(40, 40, 40, 0.84) }
      .ball {position: absolute;  border-radius: 999px; border-style: solid}
    </style>
    <script src="jquery-2.1.3.js"></script>
    <script src="Bacon.js"></script>
    <script>

      $(function() {
        Bacon.interval(500).take(10).onValue(addBall)
      })

      function addBall() {
        var $ball = createBall()

        var goingDown   = true,
            goingRight  = true

        var positionStream    = new Bacon.Bus(),
            positionProperty  = positionStream.toProperty({left: randomNumber(0, 555), top: randomNumber(0, 555)}),
            verticalStream    = positionStream.map('.top'),
            horizontalStream  = positionStream.map('.left'),
            hitsBottom        = verticalStream.filter(isGoingDown).filter(isAtMax, 'innerHeight'),
            hitsTop           = verticalStream.filter(isGoingUp).filter(isZero),
            hitsRight         = horizontalStream.filter(isGoingRight).filter(isAtMax, 'innerWidth'),
            hitsLeft          = horizontalStream.filter(isGoingLeft).filter(isZero),
            hitsTopOrBottom   = hitsBottom.merge(hitsTop),
            hitsRightOrLeft   = hitsRight.merge(hitsLeft)

        positionProperty.onValue(updatePosition)
        hitsTopOrBottom.onValue(flipY)
        hitsRightOrLeft.onValue(flipX)

        function isAtMax(dimension, position) { return position === window[dimension] - $ball.outerWidth()}
        function isZero(target) { return target === 0 }
        function updatePosition(position) {$ball.css(position)}

        function flipY() { goingDown  = !goingDown }
        function flipX() { goingRight = !goingRight }

        function isGoingDown() { return goingDown }
        function isGoingUp() { return !goingDown }
        function isGoingRight() { return goingRight }
        function isGoingLeft() { return !goingRight }

        function nextX(currentX) { return isGoingRight() ? currentX + 1 : currentX - 1 }
        function nextY(currentY) { return isGoingDown() ? currentY + 1 : currentY - 1 }

        function moveBall(position) { positionStream.push(position) }
        function toNextPosition(position) { return { left: nextX(position.left), top: nextY(position.top) } }

        Bacon.interval(1, $ball).map('.offset').map(toNextPosition).onValue(moveBall)

      }

      function createBall() {
        var diameter = randomNumber(2, 300)

        var style = {
          width: diameter,
          height: diameter,
          backgroundColor: randomCssRgba(),
          borderWidth: randomNumber(0, 20),
          borderColor: randomCssRgba()
        }

        return $('<div class="ball"/>').appendTo('body').css(style)
      }


      function randomCssRgba () {
        var rgbaArray = [randomNumber(0, 255), randomNumber(0, 255), randomNumber(0, 255), randomNumber(50, 100) * 0.01]
        return 'rgba(' + rgbaArray.join(',') + ')'
      }

      function randomNumber(min ,max) {
        return Math.floor(Math.random() * (max - min + 1) + min);
      }
    </script>
  </head>
  <body>
  </body>
</html>
